# 1. 开发环境配置

欲知逆向，先知正向。

## 1.1. 安装Android Studio

Android Studio的新版仅支持Kotlin开发，如果需要使用Java开发，需要安装Android Studio Dolphin | 2021.3.1 Patch 1 October 13, 2022版本，历史版本可在https://developer.android.google.cn/studio/archive中找到。

## 1.2. 选择Android Gradle Plugin版本

Android Gradle Plugin版本和Android Studio版本存在对应关系，可参考：https://blog.csdn.net/dongxin214/article/details/100726807。

Android Studio Dolphin | 2021.3.1 Patch 1 October 13, 2022版本对应AGP版本：3.2-7.3，这里选择7.3.1版本。

## 1.3. 选择Gradle版本

Gradle版本和Android Gradle Plugin版本存在对应关系，可参考：https://www.jianshu.com/p/344b041de1b2。

AGP 7.3.1版本对应Gradle版本：7.4。

## 1.4. 选择Android SDK版本

Android SDK版本和AGP、Gradle版本存在对应关系，可参考：https://dodoo.co/prepare/versions/android。

AGP：7.3.1和Gradle：7.4版本对应Android SDK版本：30+，这里选择32。

## 1.5. 选择Android和JDK版本

Android、JDK版本和以上环境存在对应关系，可参考：https://dodoo.co/prepare/versions/android。

根据以上环境，Android版本需要在Android 12L以上，JDK版本需要在17以上。

tips：如果选择使用Android Studio模拟机，选择不带Google Play或者Google API的版本，否则可能会面临无法获取root权限的问题。

## 1.6. 汇总
* Android Studio：Android Studio Dolphin | 2021.3.1 Patch 1 October 13, 2022（自行下载安装）
* Android Gradle Plugin：7.3.1（在项目的build.gradle文件中配置，Android Studio自动下载）
* Gradle：7.4（在项目的gradle/wrapper/gradle-wrapper.properties文件中配置，Android Studio自动下载）
* Android SDK：32（Android Studio的设置->Android SDK中下载）
* Android：12L+（模拟机或者真机需要的版本）
* JDK：17+（模拟机或者真机自带，无需安装）

如果存在其他需求，需要变更其中一个组件的版本，则需要对应修改其他组件的版本。

## 1.7. 额外

如果需要进行NDK开发，则需要安装NDK，可直接在Android Studio的设置->Android SDK中下载。
* NDK（Side by side）
* Android SDK Command-line Tools（latest）
* CMake

# 2. PC端逆向环境配置

## 2.1. frida
选择frida16.1.10版本，该版本较为稳定。
* 安装Python：3.9.0 64位
* 安装frida：pip install -i https://pypi.tuna.tsinghua.edu.cn/simple frida==16.1.10
* 安装frida-tools：pip install -i https://pypi.tuna.tsinghua.edu.cn/simple frida-tools==12.1.3
* 下载frida-server：https://github.com/frida/frida/releases/download/16.1.10/frida-server-16.1.10-android-arm64.xz（根据模拟机或者真机架构调整）
* 推送frida-server：adb push
* 在模拟机或者真机上执行frida-server
* 端口转发：adb forward tcp:27042 tcp:27042

使用方法参考链接：
* https://www.cnblogs.com/luoyesiqiu/p/10718997.html

## 2.2. 安卓模拟器

雷电模拟器的综合表现最优。

## 2.3. 其他逆向工具
* jadx：反编译工具
* apktool：解包打包工具
* keytool、jarsigner：签名工具（JDK附带）
* JEB：动态调试
* IDA Pro/Ghidra：反汇编so库

# 3. 手机端逆向环境配置

## 3.1. 操作系统

建议选择Android8.1的版本，整体兼容性会比较好。Shamiko模块最低要求版本是Android8.1，而JEB在Android9上存在严重BUG。

一加降级参考：https://bbs.oneplus.com/thread/4676868。

## 3.2. 底层：Magisk

提供Root环境，亦可以框架形式来支持自定义模块（如XPosed家族）

变种Beta版本：
* Magisk Alpha：隐藏ROOT能力更强
* Magisk Delta（Kitsune Mask）：隐藏ROOT能力更强，更加稳定

运行模式：
* Riru：包含Magisk Hide，该模式已经被弃用
* Zygisk：结合Shamiko模块实现隐藏Root和Magisk

一加手机参考：https://magiskcn.com/oneplus-boot.html。

## 3.3. 中层：XPosed家族

XPosed和frida均为Hook框架，XPosed仅支持Java层Hook，frida支持Java和Native层Hook，XPosed适合长期修改的场景，frida更适合临时调试和逆向分析场景。XPosed框架替换了系统的app_process程序，从而Hook Zygote进程，进而完成对Xygote进程及其创建的Dalvik/ART虚拟机的劫持。

参考：https://doiiars.com/article/xposed-edxposed-lsposed-diff

* XPosed：基础版，已经停止维护，支持Android 7及以前版本
* 太极：闭源
* EdXPosed：进阶版，2021年停止维护，支持Android 8.0 ~ 11
* LSPosed：进阶版，2024年停止维护，支持Android 8.1 ~ 14
* LSPosed-JingMatrix：LSPosed复苏版本：https://github.com/JingMatrix/LSPosed，支持Android 8.1 ~ 15
* VirtualXPosed：基于VirtualApp，可免Root使用XPosed框架，采用虚拟系统，导致对系统层面的模块支持不佳，2022年最后一次更新，支持Android 5.0 ~ 12.0

## 3.4. 上层：XPosed模块

* 核心破解：跳过签名验证安装应用
* 算法助手：分析算法、UI弹窗等的综合工具

## 3.5. 中上层：Magisk模块

* Shamiko：隐藏Root和Magisk，有白名单和黑名单模式，通过/data/adb/shamiko目录下的配置文件控制

## 3.6. 其他工具

* MT管理器/NP管理器：手机端文件检索、 修改、签名等工具
* 开发者助手：界面资源分析
* GameGuardian：游戏安全相关
