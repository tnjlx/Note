# 1. 设置APP可调试

## 1.1. 应用侧
* AndroidManifest.xml的application里面添加可调试权限：android:debuggable="true"

## 1.2. 系统侧
* XappDebug模块
* 后台执行`magisk resetprop ro.debuggable 1`命令，该命令重启后失效，通过`stop;start;`命令重启系统服务可以避免该问题
* 刷入MagiskHide Props Config模块


# 2. Android日志

logcat日志，可以使用adb或者Android等工具查看日志。

# 3. Frida

支持Java层和Native层的Hook，支持参数修改、逻辑修改、返回值修改和主动调用（RPC）等功能。通过Hook系统库如libart.so、libc.so、libdl.so和linker/linker64等，可以劫持系统操作。

## 3.1. Frida衍生工具
* objection：命令行快速Hook工具
* java_trace：ZenTracer、r0tracer等跟踪工具，用于分析控制流混淆
* IDA插件

## 3.2. Frida持久化
|方案|优点|缺点|
|---|---|
|patch apk|免root|需过签名校验|
|patch so||需要root，需过so校验，可能需要改包强制释放so|
|magisk框架：https://github.com/hanbinglengyue/FridaManager||需过root和magisk检测|
|jshook封装好的frida inject框架：https://github.com/Xposed-Modules-Repo/me.jsonet.jshook|||
|修改aosp源代码,在fork子进程的时候注入frida-gadget|||

# 4. 其他

## 4.1. Inline Hook工具

Frida可以进行Inline Hook，但是不太稳定，其他可参考：https://www.52pojie.cn/thread-1859820-1-1.html。

## 4.2. trace工具

参考：https://www.52pojie.cn/thread-1859820-1-1.html。

# 5. GDB/LLDB/IDA进行Native调试

# 6. JEB

## 6.1. 启动调试方式

* 附加方式：直接手动启动应用，然后启动调试
* 启动方式：该方式适合需要调试onCreate函数等前置代码的场景，通过adb启动应用：`adb shell am start -D -n com.google.sample[包名]/.MainActivity[类路径]`，然后启动调试


adb shell am start -D -n re.pwnme/re.pwnme.MainActivity
adb shell am start -D -n com.jiucl.nativeone/com.jiucl.nativeone.MainActivity
jdb -connect com.sun.jdi.SocketAttach:hostname=127.0.0.1,port=8700

# 7. so库调试

## 7.1. so加载流程

参考：https://www.52pojie.cn/thread-1809646-1-1.html。根据加载流程和实际需求，挑选断点位置。

## 7.2. IDA

IDA调试方法：https://www.cnblogs.com/ddms/p/8820044.html。

## 7.3. unidbg

unidbg是基于Unicorn（多架构CPU模拟执行框架）的一款Android平台Native代码模拟器，它可以模拟执行、监控观察和辅助算法分析和还原。如果Native代码调用了Java方法，则需要补充环境。

# 8. ARM汇编

## 8.1. 指令集

* thunm指令集：一般见于32位程序
* ARM指令集：一般见于64位程序

# 9. 抓包

## 9.1. 外部抓包

## 9.2. 内部抓包

* Hook HTTP通信框架函数
* Hook底层读写函数函数如OutputStream、SSLOutputStream等，参考：https://www.52pojie.cn/thread-1982444-1-1.html
* Hook Native层函数如sendto等

## 9.3. 抓包工具

* r0capture
* ebpf & eCapture

