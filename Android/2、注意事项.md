# 1. Frida
## 1.1. spawn启动应用失败
```
unexpectedly timed out while waiting for signal from process with PID 16112
```
应用启动优化USAP的问题，需要关闭USAP功能，并关掉USAP进程。
```shell
getprop | grep usap
setprop [xxx.usap] false  # 根据上一个命令的结果修改【】内的内容
killall usap
killall usap32
killall usap64
```

## 1.2. Hook字符串构造函数

参考：https://blog.csdn.net/LittleFishC/article/details/140913824。

需Hook StringFactory类而非String类。

```js
Java.perform(function () {
    var StringFactory = Java.use("java.lang.StringFactory");
    StringFactory.newStringFromString.implementation = function (arg) {
        var retval = this.newStringFromString(arg);
        console.log("StringFactory.newStringFromString: ", retval);
        return retval;
    }
    StringFactory.newStringFromChars.overload('[C').implementation = function (arg) {
        var retval = this.newStringFromChars(arg);
        console.log("StringFactory.newStringFromChars: ", retval);
        return retval;
    }
    StringFactory.newStringFromBytes.overload('[B').implementation = function (arg) {
        var retval = this.newStringFromBytes(arg);
        console.log("StringFactory.newStringFromBytes: ", retval);
        return retval;
    }
});
```

## 1.3. more than one overload

参考：https://www.cnblogs.com/bigcrucian/p/15956419.html

报错：
```js
has more than one overload, use .overload(<signature>) to choose from
```
函数的重载导致Frida不知道具体应该Hook哪个函数而出现的问题，将报错中的choose from后面的列表中对应参数类型的.overload(<参数类型列表>)添加到要Hook的函数名后、关键词implementation之前即可。

## 1.4. NDK开发中的so库延迟加载问题和so库不释放到本地问题

在NDK开发中，使用JNI技术时，so库为延迟加载，所以在使用frida注入时，不能采取spawn方式启动应用，会出现找不到so库的情况，应该在手动启动应用后，找到进程号，再注入，才能够找到so库。

另外，当API版本大于等于21的时候，so库在应用安装时不会被释放到/data/app目录下，在应用运行时，查看内存maps文件也不会看到so库文件，在AndroidManifest.xml的application标签中加上属性`android:extractNativeLibs="true"`即可解决该问题，so库在应用安装时会被释放到/data/app目录下。


# 2. 悬而未决的问题

* so调试 / Java调试
* 混淆对抗
* 加固对抗

# 3. JEB

## 3.1. 一直卡在Attaching To Target

端口转发冲突问题，关闭Android Studio等监视器即可

## 3.2. 读取不到本地变量

参考：https://www.pnfsoftware.com/blog/debugging-android-apps-on-android-pie-and-above/。在Android Pie（Android9.0 - API28）及更高版本上调试时可能会出现的问题。

## 3.3. 变量索引偏移问题

变量索引+1，和实际代码不符合，未知原因。


# 4. 雷电模拟器

## 4.1. adb devices未发现Android7设备

`adb connect 127.0.0.1:5555`

