- [1. Linux使用系列](#1-linux使用系列)
  - [1.1. yum仅下载软件包](#11-yum仅下载软件包)
  - [1.2. yum锁定](#12-yum锁定)
  - [1.3. apt-get相关](#13-apt-get相关)
  - [1.4. pip安装第三方库报错SSL: CERTIFICATE\_VERIFY\_FAILED](#14-pip安装第三方库报错ssl-certificate_verify_failed)
  - [1.5. CentOS7重置root密码](#15-centos7重置root密码)
  - [1.6. kali设置共享文件夹](#16-kali设置共享文件夹)
  - [1.7. Ubuntu设置VMWare共享文件夹但是没有出现](#17-ubuntu设置vmware共享文件夹但是没有出现)
  - [1.8. iptables监控端口流量大小](#18-iptables监控端口流量大小)
  - [1.9. Linux查看本机公网IP地址](#19-linux查看本机公网ip地址)
  - [1.10. Linux终端测试网速](#110-linux终端测试网速)
  - [1.11. CentOS修改SSH端口](#111-centos修改ssh端口)
  - [1.12. 使用SCP（加密传输）在Linux终端之间传输文件](#112-使用scp加密传输在linux终端之间传输文件)
  - [1.13. 在没有/etc/sysconfig/iptables配置文件的情况下持久化IP tables规则](#113-在没有etcsysconfigiptables配置文件的情况下持久化ip-tables规则)
  - [1.14. 删除文件中带指定内容的行](#114-删除文件中带指定内容的行)
- [2. Linux安装、升级软件相关](#2-linux安装升级软件相关)
  - [2.1. CentOS升级gcc版本](#21-centos升级gcc版本)
  - [2.2. CentOS安装配置vsftpd](#22-centos安装配置vsftpd)
    - [2.2.1. 安装](#221-安装)
    - [2.2.2. 修改配置文件](#222-修改配置文件)
    - [2.2.3. 修改权限问题](#223-修改权限问题)
- [3. 调试相关](#3-调试相关)
  - [3.1. 查找宏定义](#31-查找宏定义)
  - [3.2. 汇编小写字母转大写字母](#32-汇编小写字母转大写字母)
  - [3.3. 内联汇编插入int 3指令，OD载入崩溃](#33-内联汇编插入int-3指令od载入崩溃)
  - [3.4. Windbg下载符号文件](#34-windbg下载符号文件)
- [4. Github删除所有的commit记录](#4-github删除所有的commit记录)
- [5. wireshark合并及过滤数据包](#5-wireshark合并及过滤数据包)
- [6. mysql导出数据库](#6-mysql导出数据库)
- [7. 从H.264裸流文件中提取图片和还原视频](#7-从h264裸流文件中提取图片和还原视频)
  - [7.1. 提取图片](#71-提取图片)
  - [7.2. 还原视频](#72-还原视频)
- [8. 禁用Windows Defender](#8-禁用windows-defender)
- [9. GDB解除字符串长度限制](#9-gdb解除字符串长度限制)
- [10. 操作系统层面如何信任SSL连接和自签名证书](#10-操作系统层面如何信任ssl连接和自签名证书)
- [11. KVM启动qcow2镜像](#11-kvm启动qcow2镜像)
- [12. Chrome相关](#12-chrome相关)
  - [12.1. Chrome浏览器HSTS策略无法访问](#121-chrome浏览器hsts策略无法访问)
  - [12.2. Chrome浏览器截取网页全截图](#122-chrome浏览器截取网页全截图)
- [13. 查看Windows操作系统过期时间](#13-查看windows操作系统过期时间)
- [14. 查看网卡编号（用于tcpdump.exe抓包的编号）列表](#14-查看网卡编号用于tcpdumpexe抓包的编号列表)
- [15. UDP发包](#15-udp发包)
- [16. 文件类型识别](#16-文件类型识别)
- [17. NMAP扫描命令](#17-nmap扫描命令)
- [18. NETSH中转](#18-netsh中转)
- [19. 360的MID记录位置](#19-360的mid记录位置)
- [20. socat中转](#20-socat中转)
- [21. Powershell后台启动进程](#21-powershell后台启动进程)
- [22. 逆向相关](#22-逆向相关)
  - [22.1. 调试被注入进程](#221-调试被注入进程)
    - [22.1.1. JMP原地址法](#2211-jmp原地址法)
    - [22.1.2. 默认调试器法](#2212-默认调试器法)

# 1. Linux使用系列
## 1.1. yum仅下载软件包
`yum install --downloadonly --downloaddir=./ httpd`

## 1.2. yum锁定
Another app is currently holding the yum lock; waiting for it to exit...代表已经有yum进程在运行，执行`rm -f /var/run/yum.pid`即可
  
## 1.3. apt-get相关
apt-get安装软件时出现以下错误
```
E: Could not get lock /var/lib/dpkg/lock - open (11: Resource temporarily unavailable)
E: Unable to lock the administration directory (/var/lib/dpkg/), is another process using it?
```
* `ps -A | grep apt`并通过`kill -9 [pid]`杀掉相关进程
* 删除`/var/lib/apt/lists/`、`/var/lib/dpkg/`、`/var/cache/apt/archives/`这些目录下的lock相关文件
* `dpkg --configure -a`以及`sudo apt update`重新配置并更新软件包源列表
* 
## 1.4. pip安装第三方库报错SSL: CERTIFICATE_VERIFY_FAILED
python高版本需要验证ssl，如果需要忽略验证，可以添加--trusted-host来信任域名。`pip install --trusted-host pypi.org --trusted-host files.pythonhosted.org  --upgrade  baostock`

## 1.5. CentOS7重置root密码
按`e`进入编辑模式，在`quiet`后面追加空格和`init=/bin/sh`，然后按下`CTRL+X`进行引导启动，之后执行以下命令：
```bash
# 挂载根目录
mount -o remount, rw /
# passwd root修改密码
passwd root
# 刷新系统信息
touch /.autorelabel
# 重启系统，以下两个选一个即可
exec /sbin/init
exec /sbin/reboot
```

## 1.6. kali设置共享文件夹
* 虚拟机菜单设置共享文件夹
* `vmware-hgfsclient`查看共享文件夹设置是否成功
* `vmhgfs-fuse .host:/vmshare /mnt/hgfs/vmshare`进行挂载

## 1.7. Ubuntu设置VMWare共享文件夹但是没有出现
先`sudo mkdir /mnt/hgfs`，然后`sudo /usr/bin/vmhgfs-fuse .host:/ /mnt/hgfs -o subtype=vmhgfs-fuse,allow_other`

## 1.8. iptables监控端口流量大小
```bash
iptables -I OUTPUT -s 192.168.0.10 -p tcp --sport 80
iptables -n -v -L -t filter
```

## 1.9. Linux查看本机公网IP地址
`curl http://icanhazip`，注意设置DNS服务器

## 1.10. Linux终端测试网速
`curl -s https://raw.githubusercontent.com/sivel/speedtest-cli/master/speedtest.py | python -`

## 1.11. CentOS修改SSH端口
* 关闭selinux：修改`/etc/sysconfig/selinux`，将`SELINUX=enforcing`改为`SELINUX=disabled`，重启生效
* 修改端口：修改`/etc/ssh/sshd_config`，将`# Port 22`修改为`Port 10033`，重启SSH服务生效
* 修改防火墙：修改`/etc/sysconfig/iptables`，加一行`-A INPUT -m state --state NEW -m tcp -p tcp --dport 10033 -j ACCEPT`，重启iptables服务生效

## 1.12. 使用SCP（加密传输）在Linux终端之间传输文件
* 上传
  * 文件：`scp /root/1.txt root@192.168.3.1:/root`
  * 目录：`scp -r /root/data root@192.168.3.1:/root`
* 下载
  * 文件：`scp root@192.168.3.1:/root/1.txt /root`
  * 目录：`scp -r root@192.192.3.1:/root/data /root`

## 1.13. 在没有/etc/sysconfig/iptables配置文件的情况下持久化IP tables规则
使用iptables-persistent工具
```bash
# 安装
sudo apt-get install iptables-persistent
# Ubuntu14
# 保存以及reload规则
sudo invoke-rc.d iptables-persistent save
sudo invoke-rc.d iptables-persistent reload
# 或者
sudo /etc/init.d/iptables-persistent save
sudo /etc/init.d/iptables-persistent reload
# Ubuntu 16
sudo netfilter-persistent save
sudo netfilter-persistent reload
# 生成的规则将被存储在以下文件中
/etc/iptables/rules.v4
/etc/iptables/rules.v6
```

## 1.14. 删除文件中带指定内容的行
```
sed -e '/XXXXXX/d'  1.log > 2.log
```

# 2. Linux安装、升级软件相关
## 2.1. CentOS升级gcc版本
```bash
# 先安装scl（CentOS的一个第三方库，可以在不覆盖原系统软件包的情况下安装新的软件包与老软件包共存并且可以使用scl命令切换，仅仅支持64位）
yum -y install centos-release-scl
# 升级到gcc9.3，如果需要其它版本，则将数字9改为对应版本号，如7（对应gcc7.3）、8（对应gcc8.3）
yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils
# 启用gcc9.3，仅仅在当前会话有效
scl enable devtoolset-9 bash
# 如果要长期有效的话，需要写入profile文件
echo "source /opt/rh/devtoolset-9/enable" >> /etc/profile

# devtoolset-6及之前的版本已经结束支持，低版本gcc需要用其他方法升级
# 升级到gcc4.8
wget http://people.centos.org/tru/devtools-2/devtools-2.repo -O /etc/yum.repos.d/devtoolset-2.repo
yum -y install devtoolset-2-gcc devtoolset-2-gcc-c++ devtoolset-2-binutils
scl enable devtoolset-2 bash
# 升级到gcc4.9
wget https://copr.fedoraproject.org/coprs/rhscl/devtoolset-3/repo/epel-6/rhscl-devtoolset-3-epel-6.repo -O /etc/yum.repos.d/devtoolset-3.repo
yum -y install devtoolset-3-gcc devtoolset-3-gcc-c++ devtoolset-3-binutils
scl enable devtoolset-3 bash
# 升级到gcc5.2
wget https://copr.fedoraproject.org/coprs/hhorak/devtoolset-4-rebuild-bootstrap/repo/epel-6/hhorak-devtoolset-4-rebuild-bootstrap-epel-6.repo -O /etc/yum.repos.d/devtoolset-4.repo
yum install devtoolset-4-gcc devtoolset-4-gcc-c++ devtoolset-4-binutils -y
scl enable devtoolset-4 bash
```

## 2.2. CentOS安装配置vsftpd
### 2.2.1. 安装
```bash
# 安装
yum -y install vsftpd
# 设置自启动并启动
systemctl enable vsftpd.service
systemctl restart vsftpd.service
systemctl status vsftpd.service
# 创建文件夹
mkdir -p /home/myftp
# 创建用户，归属到ftp组
useradd -d /home/myftp -g ftp -s /sbin/nologin myftp
# 更改权限
chown -R myftp /home/myftp
chgrp -R ftp /home/myftp
chmod -R 775 /home/myftp
# 设置密码
passwd myftp
```

### 2.2.2. 修改配置文件
`vim /etc/vsftpd/vsftpd.conf`
```bash
# 禁止匿名登录
anonymous_enable=NO

# 禁止切换目录
# YES表示禁止所有用户切换目录；NO表示允许所有用户切换目录
chroot_local_user=YES
# YES表示存在例外用户；NO表示不存在例外用户（指chroot_local_user策略的例外）
chroot_list_enable=YES
# 指定存储例外用户列表的文件
chroot_list_file=/etc/vsftpd/chroot_list

# 允许写权限
allow_writeable_chroot=YES

# 设置被动模式
pasv_enable=YES
pasv_min_port=30000
pasv_max_port=30010
```

### 2.2.3. 修改权限问题
```bash
# 注释掉/etc/pam.d/vsftpd文件里这一行：#auth required pam_shells.so
vim /etc/pam.d/vsftpd
# 关闭selinux
```

# 3. 调试相关
## 3.1. 查找宏定义
* `find /usr/include/ -name *.h | xargs grep 'SYS_SEND'`
* `grep -nr ORIG_EAX /usr/include/`

## 3.2. 汇编小写字母转大写字母
`or al,20h`

## 3.3. 内联汇编插入int 3指令，OD载入崩溃
异常被忽略（传递给程序）所致，解决方案：
* 设置OD不忽略所有异常
* 关闭StrongOD插件的所有功能

## 3.4. Windbg下载符号文件
`"C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\symchk.exe" /r D:\files /s SRV*D:\symbols\*http://msdl.microsoft.com/download/symbols`

# 4. Github删除所有的commit记录
```bash
# 移除原来的git
rm .git -rf
# 初始化git
git init
git remote add origin https://github.com/jiucl/Notes.git
git remote -v
# 重新加入全部
git add --all
git commit -am 'RESTART'
# 推到github
git push -f origin master
```

# 5. wireshark合并及过滤数据包
* 合并：`mergecap.exe -w C:\Users\jiucl\Desktop\data\all.pcap C:\Users\jiucl\Desktop\data\2019*`
* 分割：`tshark.exe -r all.pcap -Y "ip.addr==1.1.1.1" -w 1.1.1.1.pcap`

# 6. mysql导出数据库
* 导出数据：`mysqldump -u root -p xxx > xxx.sql`，这里的XXX为数据库名称
* 仅仅导出结构：`mysqldump -u root -p -d xxx > xxx.sql`，这里的XXX为数据库名称

# 7. 从H.264裸流文件中提取图片和还原视频
下载ffmpeg.exe开源工具
## 7.1. 提取图片
-f是输出文件，-i是输入文件
`.\ffmpeg.exe  -vf select='eq(pict_type\,I)' -vsync 2 -s 1920*1080 -f image2 %02d.jpeg -i .\0x553b8f41.h264`

## 7.2. 还原视频
-o是输出文件，-i是输入文件
`.\ffmpeg.exe -c:v libx264 -c:a -o 7.mp4 -i .\0x1a2d339a.h264`

# 8. 禁用Windows Defender
* 关闭实时保护等
* 组策略禁用Windows Defender反病毒软件和实时防护

# 9. GDB解除字符串长度限制
`(gdb)set print element 0`

# 10. 操作系统层面如何信任SSL连接和自签名证书
```bash
# SSL降级
cd /etc/ssl/certs
cd ..
vim openssl.conf
# 然后修改MinProtocol = TLSv1.1 为 MinProtocol = TLSv1.0
# 然后修改CipherString = DEFAULT@SECLEVEL=2 为 CipherString = DEFAULT@SECLEVEL=1
# 然后重启系统
reboot
# 信任自签名证书
# 先将网站证书下载下来，需要crt格式，pem格式可以直接改后缀名为crt
cp zs.crt /usr/local/share/ca-certificates
update-ca-certificates
```
# 11. KVM启动qcow2镜像
```
kvm -m 1024 1.qcow2
```

# 12. Chrome相关
## 12.1. Chrome浏览器HSTS策略无法访问
在报错界面摁下键盘上英文字母 thisisunsafe ，即可进入

## 12.2. Chrome浏览器截取网页全截图
先按F12，然后按下 Ctrl + Shift + P 弹出命令框，输入命令 Capture full size screenshot 即可

# 13. 查看Windows操作系统过期时间
```
slmgr.vbs -xpr
```

# 14. 查看网卡编号（用于tcpdump.exe抓包的编号）列表
```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\Tcpip\Parameters\Interfaces
```

# 15. UDP发包
`echo "test_k_hello" | socat - udp4-datagram:192.168.0.1:443`

# 16. 文件类型识别
Python的magic库

# 17. NMAP扫描命令
nmap -sS -p 1-65535 -O -sV --version-all -T 2 -oA 82.149.225.92 -vv 82.149.225.92

# 18. NETSH中转

netsh interface portproxy add v4tov4 listenport=41234 listenaddress=192.168.43.46 connectport=22 connectaddress=149.28.24.53
netsh interface portproxy show all
netsh interface portproxy reset

# 19. 360的MID记录位置
计算机\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\360Safe\Liveup

# 20. socat中转
socat TCP4-LISTEN:10001,reuseaddr,fork TCP4:77.220.214.114:22

# 21. Powershell后台启动进程
Start-Process -WindowStyle hidden -FilePath cmd.exe

# 22. 逆向相关
## 22.1. 调试被注入进程
### 22.1.1. JMP原地址法
* 断在注入线程的CreateRemoteThread或ResumeThread等函数上
* 打开被注入进程，将起始代码修改为JMP到当前地址
* 返回注入线程，单步步过CreateRemoteThread/ResumeThread
* 使用OD附加被注入进程，会断在起始代码处，将代码修改回原来的代码即可继续执行

### 22.1.2. 默认调试器法
* 断在注入线程的CreateRemoteThread或ResumeThread等函数上
* 设置OD为默认调试器
* 打开被注入进程，将起始代码修改为0xCC
* 返回注入线程，单步步过CreateRemoteThread/ResumeThread
* OD会被拉起，将代码修改回原来的代码即可继续执行
